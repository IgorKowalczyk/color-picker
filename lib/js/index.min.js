/* (c) Igor Kowalczyk. All rights reserved. */

var addSwatch=document.getElementById("add-swatch"),modeToggle=document.getElementById("mode-toggle"),swatches=document.getElementsByClassName("default-swatches")[0],colorIndicator=document.getElementById("color-indicator"),userSwatches=document.getElementById("user-swatches"),spectrumCanvas=document.getElementById("spectrum-canvas"),spectrumCtx=spectrumCanvas.getContext("2d"),spectrumCursor=document.getElementById("spectrum-cursor"),spectrumRect=spectrumCanvas.getBoundingClientRect(),hueCanvas=document.getElementById("hue-canvas"),hueCtx=hueCanvas.getContext("2d"),hueCursor=document.getElementById("hue-cursor"),hueRect=hueCanvas.getBoundingClientRect(),currentColor="",hue=0,saturation=1,lightness=.5,rgbFields=document.getElementById("rgb-fields"),hexField=document.getElementById("hex-field"),red=document.getElementById("red"),blue=document.getElementById("blue"),green=document.getElementById("green"),hex=document.getElementById("hex");function ColorPicker(){this.addDefaultSwatches(),createShadeSpectrum(),createHueSpectrum()}function createSwatch(e,t){var o=document.createElement("button");o.classList.add("swatch"),o.setAttribute("title",t),o.style.backgroundColor=t,o.addEventListener("click",function(){var e=tinycolor(this.style.backgroundColor);colorToPos(e),setColorValues(e)}),e.appendChild(o),refreshElementRects()}function refreshElementRects(){spectrumRect=spectrumCanvas.getBoundingClientRect(),hueRect=hueCanvas.getBoundingClientRect()}function createShadeSpectrum(e){canvas=spectrumCanvas,ctx=spectrumCtx,ctx.clearRect(0,0,canvas.width,canvas.height),e||(e="#f00"),ctx.fillStyle=e,ctx.fillRect(0,0,canvas.width,canvas.height);var t=ctx.createLinearGradient(0,0,canvas.width,0);t.addColorStop(0,"#fff"),t.addColorStop(1,"transparent"),ctx.fillStyle=t,ctx.fillRect(0,0,canvas.width,canvas.height);var o=ctx.createLinearGradient(0,0,0,canvas.height);o.addColorStop(0,"transparent"),o.addColorStop(1,"#000"),ctx.fillStyle=o,ctx.fillRect(0,0,canvas.width,canvas.height),canvas.addEventListener("mousedown",function(e){startGetSpectrumColor(e)})}function createHueSpectrum(){var e=hueCanvas,t=hueCtx,o=t.createLinearGradient(0,0,0,e.height);o.addColorStop(0,"hsl(0,100%,50%)"),o.addColorStop(.17,"hsl(298.8, 100%, 50%)"),o.addColorStop(.33,"hsl(241.2, 100%, 50%)"),o.addColorStop(.5,"hsl(180, 100%, 50%)"),o.addColorStop(.67,"hsl(118.8, 100%, 50%)"),o.addColorStop(.83,"hsl(61.2,100%,50%)"),o.addColorStop(1,"hsl(360,100%,50%)"),t.fillStyle=o,t.fillRect(0,0,e.width,e.height),e.addEventListener("mousedown",function(e){startGetHueColor(e)})}function colorToHue(e){e=tinycolor(e);return tinycolor("hsl "+e.toHsl().h+" 1 .5").toHslString()}function colorToPos(e){var t=(e=tinycolor(e)).toHsl();hue=t.h;var o=e.toHsv(),r=spectrumRect.width*o.s,n=spectrumRect.height*(1-o.v),c=hueRect.height-hue/360*hueRect.height;updateSpectrumCursor(r,n),updateHueCursor(c),setCurrentColor(e),createShadeSpectrum(colorToHue(e))}function setColorValues(e){var t=(e=tinycolor(e)).toRgb(),o=e.toHex();red.value=t.r,green.value=t.g,blue.value=t.b,hex.value=o}function setCurrentColor(e){e=tinycolor(e),currentColor=e,colorIndicator.style.backgroundColor=e,document.body.style.backgroundColor=e,spectrumCursor.style.backgroundColor=e,hueCursor.style.backgroundColor="hsl("+e.toHsl().h+", 100%, 50%)"}function updateHueCursor(e){hueCursor.style.top=e+"px"}function updateSpectrumCursor(e,t){spectrumCursor.style.left=e+"px",spectrumCursor.style.top=t+"px"}ColorPicker.prototype.defaultSwatches=["#FFFFFF","#FFFB0D","#0532FF","#FF9300","#00F91A","#FF2700","#000000","#686868","#EE5464","#D27AEE","#5BA8C4","#E64AA9"],ColorPicker.prototype.addDefaultSwatches=function(){for(var e=0;e<this.defaultSwatches.length;++e)createSwatch(swatches,this.defaultSwatches[e])};var startGetSpectrumColor=function(e){getSpectrumColor(e),spectrumCursor.classList.add("dragging"),window.addEventListener("mousemove",getSpectrumColor),window.addEventListener("mouseup",endGetSpectrumColor)};function getSpectrumColor(e){e.preventDefault();var t=e.pageX-spectrumRect.left,o=e.pageY-spectrumRect.top;t>spectrumRect.width&&(t=spectrumRect.width),t<0&&(t=0),o>spectrumRect.height&&(o=spectrumRect.height),o<0&&(o=.1);var r=t/spectrumRect.width*100,n=1-o/spectrumRect.height*100/100,c=r/100;lightness=n/2*(2-c),saturation=n*c/(1-Math.abs(2*lightness-1));var s=tinycolor("hsl "+hue+" "+saturation+" "+lightness);setCurrentColor(s),setColorValues(s),updateSpectrumCursor(t,o)}function endGetSpectrumColor(e){spectrumCursor.classList.remove("dragging"),window.removeEventListener("mousemove",getSpectrumColor)}function startGetHueColor(e){getHueColor(e),hueCursor.classList.add("dragging"),window.addEventListener("mousemove",getHueColor),window.addEventListener("mouseup",endGetHueColor)}function getHueColor(e){e.preventDefault();var t=e.pageY-hueRect.top;t>hueRect.height&&(t=hueRect.height),t<0&&(t=0);var o=t/hueRect.height;hue=360-360*o;var r=tinycolor("hsl "+hue+" 1 .5").toHslString(),n=tinycolor("hsl "+hue+" "+saturation+" "+lightness).toHslString();createShadeSpectrum(r),updateHueCursor(t,r),setCurrentColor(n),setColorValues(n)}function endGetHueColor(e){hueCursor.classList.remove("dragging"),window.removeEventListener("mousemove",getHueColor)}red.addEventListener("change",function(){colorToPos(tinycolor("rgb "+red.value+" "+green.value+" "+blue.value))}),green.addEventListener("change",function(){colorToPos(tinycolor("rgb "+red.value+" "+green.value+" "+blue.value))}),blue.addEventListener("change",function(){colorToPos(tinycolor("rgb "+red.value+" "+green.value+" "+blue.value))}),addSwatch.addEventListener("click",function(){createSwatch(userSwatches,currentColor)}),modeToggle.addEventListener("click",function(){rgbFields.classList.contains("active")?rgbFields.classList.remove("active"):rgbFields.classList.add("active"),hexField.classList.contains("active")?hexField.classList.remove("active"):hexField.classList.add("active")}),window.addEventListener("resize",function(){refreshElementRects()}),new ColorPicker;